---
- name: Check nvm installation
  stat:
    path: ~/.nvm/nvm.sh
  register: nvm_installed

- name: Fetch nvm install script
  get_url:
    url: https://raw.githubusercontent.com/nvm-sh/nvm/{{ nvm_version }}/install.sh
    dest: /tmp/nvm-installer
    mode: 'u=rwx,g=rx'
  when: not nvm_installed.stat.exists

- name: Launch nvm installer
  shell: bash /tmp/nvm-installer
  when: not nvm_installed.stat.exists

- name: Add zsh-nvm plugin
  git:
    repo: 'https://github.com/lukechilds/zsh-nvm'
    dest: '~/.oh-my-custom/plugins/zsh-nvm'

- name: Add zsh-nvm local settings
  blockinfile:
    path: ~/.zshrc_pre
    create: true
    marker: "# {mark} ANSIBLE MANAGED NVM BLOCK -->"
    block: |
      export NVM_LAZY_LOAD=true
      export NVM_COMPLETION=true
    mode: 'u=rw,g=r'
