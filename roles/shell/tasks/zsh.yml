---
- name: Install Zsh
  apt:
    name: zsh
    state: present
  become: yes

- name: Set current shell to Zsh
  become: yes
  user:
    name: "{{ ansible_user_id }}"
    shell: /bin/zsh

- name: Clone oh-my-zsh for users
  git:
    dest: '~/.oh-my-zsh'
    repo: 'https://github.com/robbyrussell/oh-my-zsh.git'
    update: true
    accept_hostkey: true
    version: "master"
  register: "omz_clone"

- name: Set permissions of oh-my-zsh
  file:
    path: ~/.oh-my-zsh
    mode: 'go-w'
    recurse: yes
  when: "omz_clone is changed"

- name: Copy .zshrc for users
  template:
    src: zshrc.j2
    dest: ~/.zshrc
    mode: 'u=rw,go=r'

- name: Import lambda-gister theme
  get_url: 
    url: 'https://raw.githubusercontent.com/ergenekonyigit/lambda-gitster/main/lambda-gitster.zsh-theme'
    dest: ~/.oh-my-zsh/themes/lambda-gitster.zsh-theme

- name: Create custom plugin directory
  file:
    path: ~/.oh-my-custom/plugins
    state: directory

- name: Add extra plugins
  git:
    repo: "{{ item.value }}"
    dest: "~/.oh-my-custom/plugins/{{ item.key}}"
  loop: "{{ oh_my_sh_extra_plugins | dict2items }}"
